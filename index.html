<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Active.sav Save Editor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label, select, button, input { margin-top: 10px; display: block; padding: 6px; }
  </style>
</head>
<body>
  <h2>üéÆ Active.sav Editor (Menu gi·ªëng Python)</h2>

  <input type="file" id="fileInput"><br>

  <label>üî¢ Ch·ªçn ch·∫ø ƒë·ªô ch·ªânh s·ª≠a:</label>
  <select id="mode">
    <option value="">-- Ch·ªçn --</option>
    <option value="1">1 - FPS</option>
    <option value="2">2 - ƒê·ªì ho·∫°</option>
    <option value="3">3 - M√†u s·∫Øc</option>
  </select>

  <label>üìù Nh·∫≠p gi√° tr·ªã m·ªõi (1, 2, 3...):</label>
  <input type="number" id="valueInput" placeholder="VD: 3">

  <button onclick="editFile()">‚úÖ Ch·ªânh s·ª≠a v√† T·∫£i file</button>

  <script>
    const KEYS = {
      1: [ // FPS
        'BattleFPS\u0000\u000C\u0000\u0000\u0000IntProperty',
        'LobbyFPS\u0000\u000C\u0000\u0000\u0000IntProperty',
        'FPSLevel\u0000\u000C\u0000\u0000\u0000IntProperty'
      ],
      2: [ // ƒê·ªì h·ªça
        'LobbyRenderQuality\u0000\u000C\u0000\u0000\u0000IntProperty',
        'BattleRenderQuality\u0000\u000C\u0000\u0000\u0000IntProperty'
      ],
      3: [ // M√†u s·∫Øc
        'LobbyRenderStyle\u0000\u000C\u0000\u0000\u0000IntProperty',
        'BattleRenderStyle\u0000\u000C\u0000\u0000\u0000IntProperty'
      ]
    };

    let buffer, view;

    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        buffer = event.target.result;
        view = new DataView(buffer);
        alert("‚úÖ File ƒë√£ ƒë∆∞·ª£c t·∫£i xong.");
      };
      reader.readAsArrayBuffer(file);
    });

    function findBytes(haystack, needle) {
      outer: for (let i = 0; i <= haystack.length - needle.length; i++) {
        for (let j = 0; j < needle.length; j++) {
          if (haystack[i + j] !== needle[j]) continue outer;
        }
        return i;
      }
      return -1;
    }

    function editFile() {
      const mode = parseInt(document.getElementById("mode").value);
      const value = parseInt(document.getElementById("valueInput").value);

      if (!buffer || isNaN(mode) || isNaN(value)) {
        alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn ch·∫ø ƒë·ªô v√† nh·∫≠p gi√° tr·ªã.");
        return;
      }

      const uint8 = new Uint8Array(buffer);
      let changed = 0;

      for (let key of KEYS[mode]) {
        const keyBytes = new TextEncoder().encode(key);
        const index = findBytes(uint8, keyBytes);

        if (index !== -1) {
          const yIndex = key.indexOf("IntProperty") + "IntProperty".length - 1;
          const patchIndex = index + yIndex + 11;

          if (patchIndex < buffer.byteLength) {
            view.setUint8(patchIndex, value);
            changed++;
          }
        }
      }

      if (changed > 0) {
        const blob = new Blob([buffer], { type: "application/octet-stream" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "Active_edited.sav";
        a.click();
        alert(`‚úÖ ƒê√£ ch·ªânh ${changed} m·ª•c th√†nh gi√° tr·ªã ${value}`);
      } else {
        alert("‚ùå Kh√¥ng t√¨m th·∫•y key n√†o ph√π h·ª£p.");
      }
    }
  </script>
</body>
</html>
